=encoding utf8

=head1 NAME

Unicode::LineBreak::JA_JP - UAX #14 ユニコード行分割アルゴリズム

=head1 SYNOPSIS

    use Unicode::LineBreak;
    $lb = Unicode::LineBreak->new();
    $broken = $lb->break($string);

=head1 DESCRIPTION

Unicode::LineBreak は、ユニコード標準附属書14 [UAX #14] で述べるユニコード行分割アルゴリズムを実行する。
分割位置を決定する際に East_Asian_Width 参考属性 [UAX #11] も考慮する。

B<NOTE>: This is alpha release just for proof-of-concept.


=cut

=head2 公開インタフェース

=over 4

=item new ([KEY => VALUE, ...])

コンストラクタ。
KEY => VALUE の対については L</オプション> を参照。

=back


=cut

=over 4

=item $self->config (KEY)

=item $self->config (KEY => VALUE, ...)

インスタンスメソッド。
設定を取得または変更する。
KEY => VALUE の対については L</オプション> を参照。

=back


=cut

=over 4

=item $self->break(STRING)

インスタンスメソッド。
文字列 STRING を分割し、それを返す。

=back


=cut

=head2 オプション

L<new>、L<config> の両メソッドには以下の対を指定できる。

=over 4

=item Breaking => METHOD

分割した行を整形する方法を指定する。

=over 4

=item C<"DEFAULT">

初期の方法。
任意分割の位置に改行を挿入するだけ。

=item C<"FIXED">

Same as C<"NEWLINE"> below except that lines preceded by C<">"> won't
be broken.

=item C<"FLOWED">

Flowed formatting defined in RFC 3676.

=item C<"NEWLINE">

Newline オプションで指定したもので改行の文字列を置き換えるか、挿入する。
改行の前とテキスト終端の空白文字を除去する。
テキスト終端に改行がなければ追加する。

=item C<"RFC2646">

(Obsoleted) flowed formatting defined in RFC 2646.
Using C<"FLOWED"> method is encouraged.

=item C<"TRIM">

任意分割の位置に改行を挿入する。
改行の前の空白文字を除去する。

=item サブルーチンへの参照

L</"行分割動作のカスタマイズ"> 参照。

=back

Newline オプションも参照。

=item Charset => CHARSET

文字列を符号化しているキャラクタセット。
初期値は C<"UTF-8">。

=item Context => CONTEXT

Along with Charset option, this may be used to define language/region
context.
Currently available contexts are C<"EASTASIAN"> and C<"NONEASTASIAN">.
Default context is C<"NONEASTASIAN">.

=item HangulAsAL => C<"YES"> | C<"NO">

ハングル音節とハングル連結チャモ〔conjoining jamo〕を音素文字的〔alphabetic〕(AL) に扱う。
初期値は C<"NO">。

=item Language => LANGUAGE

Along with Charset option, this may be used to define language/region
context.
See Context option.

=item LegacyCM => C<"YES"> | C<"NO">

前に空白文字がついた結合文字を単独の結合文字と扱う。
Unicode 5.0 版からは、空白文字のこのような使いかたは推奨されない。
初期値は C<"YES">。

=item MaxColumns => NUMBER

行の最大桁数 (改行の文字列と行端の空白文字を含めない)。つまり、行の最大長。
初期値は C<76>。

=item Newline => STRING

改行の文字列とするユニコード文字列。
初期値は C<"\n">。

=item NSKanaAsID => C<">CLASS...C<">

CLASS で指定した分類に基づき、一部の行頭禁止文字 (NS) を通常の表語文字的〔ideographic〕な文字 (ID) と扱う。
CLASS には以下の部分文字列を含められる。

=over 4

=item C<"ALL">

下記の文字すべて。
C<"YES"> も同じ。

=item C<"ITERATION MARKS">

表語文字的な繰り返し記号。

注。仮名ではないものもある。

=item C<"KANA SMALL LETTERS">, C<"PROLONGED SOUND MARKS">

小書き仮名、長音記号。

注。これらの文字は行頭禁止文字と扱われることも、通常の表語文字的に扱われることもある。[JIS X 4051] 6.1.1 参照。

=item C<"MASU MARK">

U+303C ます記号。

注。この文字は仮名ではないが、通常 C<"ます"> や C<"マス"> の略記として用いられる。

注。この文字は [UAX #14] では行頭禁止文字 (NS) に分類されるが、[JIS X 4051] では文字クラス (13) (ID に相当) に分類される。

=item C<"NO">

初期値。
以上のいずれの文字も ID と扱わない。

=back

=item OutputCharset => CHARSET

break() の結果を符号化するキャラクタセット。
特殊値 C<"_UNICODE_"> を指定すると、結果はユニコード文字列となる。
初期値は Charset オプションの値。

=back

=head2 行分割動作のカスタマイズ

Breaking オプションにサブルーチンへの参照を指定する場合、そのサブルーチンは 3 つの引数を取れなければならない。オブジェクトのインスタンス、事象の種類、文字列である。
事象の種類は文字列で、サブルーチンが呼ばれた文脈を表す。
文字列は分割位置の前または後のユニコード文字列の断片である。

    事象  |駆動の契機           |文字列の値
    -----------------------------------------------------------------
    "sot" |テキスト先頭         |最初の行の断片
    "sop" |強制分割の後         |次の行の断片
    "sol" |任意分割の後         |続きの行の断片
    ""    |分割の直前           |行全体 (終端の空白文字を除く)
    "eol" |任意分割             |分割位置の前の空白文字
    "eop" |強制分割             |改行とその前の空白文字
    "eot" |テキスト終端         |テキスト終端の空白文字 (と改行)
    -----------------------------------------------------------------

サブルーチンは、テキストの断片を修正して返さなければならない。なにも修正しなかったことを示すには、C<undef> を返せばよい。
なお、C<"sot">、C<"sop">、C<"sol"> の文脈での修正はその後の分割位置の決定に影響するが、ほかの文脈での修正は影響しない。


=cut

=head2 Customizing Character Properties

I<To be written>.


=cut

=head2 Configuration Files

L</new> メソッドおよび L</config> メソッドのオプション引数の組み込み初期値は、 設定ファイルで上書きできる。
F<MIME/Charset/Defaults.pm> と F<Unicode/LineBreak/Defaults.pm>。
詳細は F<Unicode/LineBreak/Defaults.pm.sample> を読んでほしい。

=head2 標準への適合性

このモジュールで用いている文字属性の値は、ユニコード標準 5.1.0 版によるものである。

このモジュールでは、実装水準 UAX14-C2 を実装しているつもりである。

=over 4

=item *

Some ideographic characters may be treated either as NS or as ID by choice
(See [JIS X 4051]).

=item *

Hangul syllables and conjoining jamos may be treated as
either H2/H3/JL/JT/JV or AL by choice.

=item *

Characters assigned to AI may be resolved to either AL or ID by choice.

=item *

Character(s) assigned to CB are not resolved.

=item *

Characters assigned to SA are resolved to AL,
except that characters that have General_Category Mn or Mc be resolved to CM.

=item *

Characters assigned to SG or XX are resolved to AL.

=back

=head1 CAVEAT

I<To be written>.

=head1 BUGS

バグやバグのような動作は、開発者に教えてください。L</AUTHOR> を参照。

=head1 VERSION

$VERSION 変数を参照してほしい。

このモジュールの開発版が
L<http://hatuka.nezumi.nu/repos/Unicode-LineBreak/>
にある。

=head1 REFERENCES

=over 4

=item [JIS X 4051]

JIS X 4051:2004
I<日本語文書の組版方法>.
日本規格協会, 2004.

=begin comment

=item [JLREQ]

阿南康宏・千葉弘幸・枝本順三郎他 (2008).
I<日本語組版処理の要件: W3C 草案 2008年10月15日>.
L<http://www.w3.org/TR/2008/WD-jlreq-20081015/ja/>.

=end comment

=item [UAX #11]

A. Freytag (2008).
I<Unicode Standard Annex #11: East Asian Width>, Revision 17.
L<http://unicode.org/reports/tr11/>.

=item [UAX #14]

A. Freytag and A. Heninger (2008).
I<Unicode Standard Annex #14: Unicode Line Breaking Algorithm>, Revision 22.
L<http://unicode.org/reports/tr14/>.

=back

=head1 SEE ALSO

L<Text::Wrap>.

=head1 AUTHOR

Copyright (C) 2009 Hatuka*nezumi - IKEDA Soji <hatuka(at)nezumi.nu>.

This program is free software; you can redistribute it and/or modify it 
under the same terms as Perl itself.


=cut

